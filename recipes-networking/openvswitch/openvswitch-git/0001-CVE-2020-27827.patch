From ee9ca9eded084255f54957391c9534adef635e22 Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Mon, 25 Oct 2021 11:19:12 +0530
Subject: [PATCH] CVE-2020-27827

Upstream-Status: Backport from https://github.com/lldpd/lldpd/commit/a8d3c90feca548fc0656d95b5d278713db86ff61

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 lib/lldp/lldp.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/lib/lldp/lldp.c b/lib/lldp/lldp.c
index 74f747fcd..b2e14e9d6 100644
--- a/lib/lldp/lldp.c
+++ b/lib/lldp/lldp.c
@@ -464,11 +464,14 @@ lldp_decode(struct lldpd *cfg OVS_UNUSED, char *frame, int s,
             b = xzalloc(tlv_size + 1);
             PEEK_BYTES(b, tlv_size);
             if (tlv_type == LLDP_TLV_PORT_DESCR) {
-                port->p_descr = b;
+                free(port->p_descr);
+                port->p_descr = b;
             } else if (tlv_type == LLDP_TLV_SYSTEM_NAME) {
-                chassis->c_name = b;
+                free(chassis->c_name);
+                chassis->c_name = b;
             } else {
-                chassis->c_descr = b;
+                free(chassis->c_descr);
+                chassis->c_descr = b;
             }
             break;
 
-- 
2.25.1

