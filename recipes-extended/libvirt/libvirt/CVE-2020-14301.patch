From 524de6cc35d3b222f0e940bb0fd027f5482572c5 Mon Sep 17 00:00:00 2001
From: Peter Krempa <pkrempa@redhat.com>
Date: Tue, 14 Apr 2020 10:26:24 +0200
Subject: [PATCH] virstoragetest: testBackingParse: Use
 VIR_DOMAIN_DEF_FORMAT_SECURE when formatting xml

We want to format even the secure information in tests.

Signed-off-by: Peter Krempa <pkrempa@redhat.com>
Reviewed-by: Erik Skultety <eskultet@redhat.com>
---
 tests/virstoragetest.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/tests/virstoragetest.c b/tests/virstoragetest.c
index 6e8ebeba134..6d2b21c25f3 100644
--- a/tests/virstoragetest.c
+++ b/tests/virstoragetest.c
@@ -594,6 +594,7 @@ testBackingParse(const void *args)
     g_autoptr(virStorageSource) src = NULL;
     int rc;
     int erc = data->rv;
+    unsigned int xmlformatflags = VIR_DOMAIN_DEF_FORMAT_SECURE;
 
     /* expect failure return code with NULL expected data */
     if (!data->expect)
@@ -613,7 +614,7 @@ testBackingParse(const void *args)
         return -1;
     }
 
-    if (virDomainDiskSourceFormat(&buf, src, "source", 0, false, 0, true, NULL) < 0 ||
+    if (virDomainDiskSourceFormat(&buf, src, "source", 0, false, xmlformatflags, true, NULL) < 0 ||
         !(xml = virBufferContentAndReset(&buf))) {
         fprintf(stderr, "failed to format disk source xml\n");
         return -1;
