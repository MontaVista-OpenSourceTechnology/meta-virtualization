From a63b48c5ecef077bf0f909a85f453a605600cf05 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=A1n=20Tomko?= <jtomko@redhat.com>
Date: Fri, 18 Sep 2020 17:56:37 +0200
Subject: [PATCH] qemu: agent: set ifname to NULL after freeing
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

CVE-2020-25637

Signed-off-by: JÃ¡n Tomko <jtomko@redhat.com>
Reported-by: Ilja Van Sprundel <ivansprundel@ioactive.com>
Fixes: 0977b8aa071de550e1a013d35e2c72615e65d520
Reviewed-by: Mauro Matteo Cascella <mcascell@redhat.com>
Reviewed-by: Jiri Denemark <jdenemar@redhat.com>

Upsteam-Status: Backport
CVE: CVE-2020-25637 dep#3
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 src/qemu/qemu_agent.c | 1 +
 1 file changed, 1 insertion(+)

Index: libvirt-6.1.0/src/qemu/qemu_agent.c
===================================================================
--- libvirt-6.1.0.orig/src/qemu/qemu_agent.c
+++ libvirt-6.1.0/src/qemu/qemu_agent.c
@@ -2186,6 +2186,7 @@ qemuAgentGetInterfaces(qemuAgentPtr mon,
 
         /* Has to be freed for each interface. */
         virStringListFree(ifname);
+        ifname = NULL;
 
         /* as well as IP address which - moreover -
          * can be presented multiple times */
